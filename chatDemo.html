<html>
  <head>
    <title>Polymer-websockets chat demo</title>
      <script src="components/platform/platform.js"></script>
      <link rel="import" href="components/polymer/polymer.html">
      <link rel="import" href="socket-io.html">

  </head>
<body>

  <polymer-element name="chat-app" attributes="inMessage outMessage outEventName">
    <template>
      <socket-io socketUrl="http://localhost:8082" 
      autoConnect listenTo=["message"] inMessage={{inMessage}} outMessage={{outMessage}} outEventName={{outEventName}}>
      </socket-io>
      <div>
        <input type="text" id="messageInput" on-keydown="{{onMessageKeydown}}" />
        <button on-click="{{sendMessage}}">Send</button>
      </div>
      <template repeat="{{message in messages}}">
        <div style="max-height:400px">
          <div>
            <span style="color: {{ {'red': message.sender!='me', 'blue':message.sender=='me'} | tokenList  }}">{{message.sender}} :</span>
            <span>{{message.content}} </span>
          </div>
        </div>
      </template>
    </template>
    <script>
      Polymer("chat-app", {
        outEventName: "foo",
        messages: [],
        sendMessage:function(event){
          if(this.$.messageInput.value != "") {
            this.outMessage = {content:this.$.messageInput.value,ts:new Date().getTime(),sender:"me"};
            //without timestamp etc outmessage does not change
            this.messages.push(this.outMessage);
            this.$.messageInput.value = "";
          }
        },
        onMessageKeydown:function(event)
        { if(event.keyCode && event.keyCode==13) this.sendMessage();
        },
        inMessageChanged:function(){
          this.messages.push(this.inMessage);
        }
      });
    </script>
  </polymer-element>

  <chat-app outEventName="message"> </chat-app>

  <script>
    window.addEventListener('WebComponentsReady', function() {
	    var socketIo = document.querySelector('socket-io');
    });
      
    
  </script>  
</body>
</html>
